@startuml
title UC-04 Enroll in Course (Sequence)
participant User
participant WebApp
participant CourseService
participant EnrollmentService
participant PaymentService
participant PaymentGateway
participant DB
participant NotificationService

User -> WebApp: Click Enroll/Buy
WebApp -> CourseService: getPrice(courseId)
CourseService -> DB: SELECT price
DB --> CourseService: price

alt free course
WebApp -> EnrollmentService: createEnrollment(userId, courseId)
EnrollmentService -> DB: INSERT enrollment (ENROLLED)
DB --> EnrollmentService: created
EnrollmentService -> NotificationService: notifyEnrolled(user)
NotificationService --> User: in-app/email
else paid course
WebApp -> PaymentService: createPaymentIntent(userId, courseId, amount)
PaymentService -> DB: INSERT payment(status=PENDING)
DB --> PaymentService: paymentRecord
PaymentService -> PaymentGateway: redirect/charge
PaymentGateway --> PaymentService: success/fail (sync or via webhook)
alt success
PaymentService -> DB: update payment(status=SUCCESS)
PaymentService -> EnrollmentService: createEnrollment(userId, courseId, isPaid=true)
EnrollmentService -> DB: INSERT enrollment
EnrollmentService -> NotificationService: notifyEnrolled(user)
NotificationService --> User: receipt & notification
else failed
PaymentService -> DB: update payment(status=FAILED)
PaymentService --> WebApp: show error
end
end
@enduml
