@startuml
title UC-04 Enroll in Course (Free or Paid)
start
:User clicks Enroll/Buy;
partition "System" {
  :Fetch course price & availability;
  if (price == 0) then (free)
    :Create Enrollment (ENROLLED);
    :Send notification / confirmation;
    stop
  else (paid)
    :Show checkout UI;
    :Collect payment method;
    :Create payment intent;
    note right: Payment Gateway
    if (payment success?) then (yes)
      :Record Payment SUCCESS;
      :Create Enrollment (ENROLLED, isPaid=true);
      :Send receipt & notification;
      stop
    else (no)
      :Record Payment FAILED;
      :Show error to user;
      stop
    endif
  endif
}
@enduml
